function loadAccountManager(){$("#bottomLeftFab").click(onFabClick);ss.get(function(b){accountMetadata=JSON.parse(b).accounts;console.info("Successfully updated metadata!");$("#loading").hide();var c=$("#accountList");c.fadeOut(FADE_TIME,function(){c.empty();$.each(accountMetadata,function(a,b){c.append('<ons-list-item tappable modifier="longdivider" class="card"><ons-col class="listLeft" width="85%"><div class="friendlyName">'+b.name+'</div><div class="username">'+b.login+'</div><div class="districtName">'+
b.districtName+'</div></ons-col><ons-col class="listRight" width="15%" onclick="loadEditor('+a+')"><ons-icon icon="fa-pencil" size="30px"></ons-icon></ons-col></ons-list-item>')});c.fadeIn(2*FADE_TIME)})},function(b){console.error("Error: "+b);displayErrorPage("#acctMgrErrMsgDiv","Oh No!","We couldn't load account information. Please try again later.","ErrorCircle",function(){$("#acctMgrErrMsgDiv").fadeOut(ERR_FADE_TIME,loadAccountManager)})},"accountMetadata")}
function loadEditor(b){var c=$("#rightBtn"),a=$("#leftBtn");c.off("click");c.click(function(){validateAndSave(b)});c.children().eq(0).attr("class","ons-icon fa fa-save");a.off("click");a.click(goBack);a.children().eq(0).attr("class","ons-icon fa fa-arrow-left");document.addEventListener("backbutton",goBack,!1);navi._backButtonHandler.disable();ons.disableDeviceBackButtonHandler();var d=accountMetadata[b];navi.pushPage("accounts/accountEditor.html",{animation:"lift",animationOptions:{duration:.25}}).then(function(){$("#editorLoading").hide();
$("#editName").val(d.name);$("#editLogin").val(d.login);$("#editPassword").val(d.password);$("#editDistName").val(d.districtName);$("#editURL").val(d.url);$("#bottomLeftRemoveFab").click(function(){removeAcct(b)});$("#editList").fadeIn(2*FADE_TIME)})}
function validateAndSave(b){function c(){var c=$.post(a.url+"skyporthttp.w",{requestAction:"eel",codeType:"tryLogin",login:a.login,password:a.password}).done(function(){if(-1<c.responseText.toLowerCase().indexOf("invalid login or password")||-1===c.responseText.toLowerCase().indexOf(a.login))alertMsg("Invalid credentials :(","Error"),$("#pw").val("");else{var d={accounts:[]};d.accounts=accountMetadata.slice();d.accounts[b]=a;ss.set(function(a){console.info("Successfully saved "+a);loadAccountManager();
loadAcctList(b);goBack()},function(a){console.error("Error: "+a);alertMsg("Failed to save account information. Please try again.","Error")},"accountMetadata",JSON.stringify(d))}}).fail(function(a){console.error(a.statusCode());0===a.readyState?alertMsg("Please check your internet connection and try again.","Error"):alertMsg("Please check your specified District URL and try again.","Error")})}var a={};a.login=$("#editLogin").val().trim().toLowerCase();a.password=$("#editPassword").val().trim();a.name=
$("#editName").val().trim();a.districtName=$("#editDistName").val().trim();a.url=$("#editURL").val().trim();accountMetadata[b].overrides&&(a.overrides=accountMetadata[b].overrides);if(0===a.name.length)alertMsg("Please enter a name for this account.");else if(0===a.districtName.length)alertMsg("Please enter a name for this account's district.");else{"/"!==a.url.charAt(a.url.length-1)&&(a.url+="/");for(var d=!1,e=0;e<accountMetadata.length;e++)d||e===b||accountMetadata[e].login!==a.login.toLowerCase()||
accountMetadata[e].url!==a.url||(d=!0,ons.notification.confirm({message:"You have already linked this Skyward\u00ae account to ScoreScope. Do you want to continue anyways?",buttonLabels:["Yes","No"],primaryButtonIndex:0}).then(function(a){0===a&&c()}));d||c()}}
function goBack(){var b=$("#rightBtn"),c=$("#leftBtn");b.off("click");b.children().eq(0).attr("class","ons-icon fa fa-refresh");b.click(onRefreshClick);c.off("click");c.children().eq(0).attr("class","ons-icon fa fa-bars");c.click(function(){menu.toggle()});document.removeEventListener("backbutton",goBack,!1);document.removeEventListener("backbutton",updateTitle,!1);navi._backButtonHandler.enable();ons.enableDeviceBackButtonHandler();document.addEventListener("backbutton",updateTitle,!1);navi.popPage()}
function onFabClick(){window.location.replace("accounts/firstRun.html")}
function removeAcct(b){var c={accounts:[]};accountMetadata.splice(b,1);c.accounts=accountMetadata.slice();ss.set(function(a){console.info("Successfully saved "+a);0==accountMetadata.length?(loadAccountManager(),goBack(),ss.remove(function(a){console.info("Successfully removed "+a)},function(a){console.error("Error: "+a);alertMsg("Failed to update account database. Please try again later.","Error")},"accountMetadata"),alertMsg("To use ScoreScope, you must have at least one account.","",function(){window.location.replace("accounts/firstRun.html")})):
(loadAccountManager(),loadAcctList(),goBack())},function(a){console.error("Error: "+a);alertMsg("Failed to update account database. Please try again later.","Error")},"accountMetadata",JSON.stringify(c))};