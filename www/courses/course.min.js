var basePIColors="#BA302D #039BE5 #7CB342 #AFBF1F #5E35B1 #1AAB8B".split(" ");
function getAndParseCourse(a,e,f){$("#iOSBackBtn").fadeIn(IOS_BTN_FADE_TIME);"undefined"===typeof f&&navi.pushPage("courses/course.html",{animation:"slide",animationOptions:{duration:TRANSITION_TIME}});var d=$.post(currentAcctURL+"gradebook003.w",{dwd:currentDWD,wfaacl:currentWFAACL,currentStudent:currentStudentID,currentExtType:a.extType,currentExtNum:a.extNum,currentGBId:a.GBID,currentCourseId:a.courseID,LinkData:"studentaccess.w"}).done(function(){var b=$((new DOMParser).parseFromString(d.responseText,
"text/html"));a.categories=[];b=b.find(".categories");if(0<b.length){for(var b=$(b[0]),f=-1,h={name:null,weight:null,average:null,items:[]};0<b.next().length;){var c;if(-1<b.attr("class").indexOf("categories")){f++;a.categories.push($.extend(!0,{},h));c=a.categories[f];c.name=$(b[0].firstChild.firstChild).text().trim();var g=$(b[0].firstChild).children().text().trim();c.weight=Math.round(+g.substr(g.indexOf("(")+1,g.indexOf("%")-1));c.average=0<b.children().eq(2).text().trim().length?+b.children().eq(2).text().trim():
"&nbsp;&nbsp;";c.items=[]}else c.items.push({date:b.children().eq(0).text().trim(),name:b.children().eq(1).text().trim(),modifier:b.children().eq(2).text().trim(),grade:b.children().eq(3).text().trim()});b=b.next()}e(a)}else $("#assignmentList").empty(),displayErrorPage("#courseErrMsgDiv","Oh No!","The server sent a malformed response.","ErrorCircle",function(){$("#loading").fadeIn(FADE_TIME);$("#courseErrMsgDiv").fadeOut(ERR_FADE_TIME,function(){getAndParseCourse(a,e,!0)})})}).fail(function(b){0===
b.readyState?displayErrorPage("#courseErrMsgDiv","Oh No!","We couldn't establish a connection. Please check your internet connection and try again.","ErrorTriangle",function(){$("#loading").fadeIn(FADE_TIME);$("#courseErrMsgDiv").fadeOut(ERR_FADE_TIME,function(){getAndParseCourse(a,e,!0)})}):displayErrorPage("#courseErrMsgDiv","Oh No!","We couldn't retrieve assignment data (HTTP "+b.status+"). Please check your internet connection and try again.","ErrorTriangle",function(){$("#loading").fadeIn(FADE_TIME);
$("#courseErrMsgDiv").fadeOut(ERR_FADE_TIME,function(){getAndParseCourse(a,e,!0)})})})}
function loadGrades(a){var e=a.categories,f=$("#loading"),d=$("#assignmentList");d.empty();d.show();var b,l,h=[],c=[],g=1,k=[];f.fadeOut(2*FADE_TIME,function(){d.append('<div class="asmtHeader"><div id="asmtHeaderLeft"><div id="asmtCourseName">'+a.name+'</div><div id="asmtCourseTeacher">'+a.teacher+'</div></div><select id="asmtHeaderRight"><option selected extType="'+a.extType+'" extTerm="'+a.extNum+'" termName="'+a.termName+'" value="0">'+a.termName+"</option></select></div>");$("#asmtHeaderRight").on("change",
function(){selectGradingPeriod(a)});d.append('<div id="piDiv"><ons-row><ons-col width="'+.55*$(window).width()+'px" vertical-align="center"><canvas id="piChart" height="'+.55*$(window).width()+'px" width="'+.55*$(window).width()+'"></canvas></ons-col><ons-col vertical-align="center"><div id="piLegend" class="systemFont"></div></ons-col></ons-row></div>');b=$("#piLegend");l=$("#piChart");$.each(e,function(a,c){d.append('<ons-row class="threeCols"><ons-col class="catColWeight">'+c.name+" ("+c.weight+
"%)</ons-col>"+(isNumber(c.average)?'<ons-col class="catColAvg" width="100px">Average: '+c.average+"</ons-col>":"")+"</ons-row>");d.append('<ons-row id="legend"><ons-col class="alignL" width="85px">Date</ons-col><ons-col class="alignL">Assignment</ons-col><ons-col class="alignR" width="35px">Score</ons-col></ons-row><div id="legendDiv"></div>');isNumber(e[a].average)?($.each(e[a].items,function(a,b){d.append('<ons-row class="assignment"><ons-col class="alignL" width="85px">'+b.date+'</ons-col><ons-col class="alignL">'+
b.name+"</ons-col>"+(isNumber(b.grade)?'<ons-col class="alignR" width="30px">'+b.grade+"</ons-col></ons-row>":'<ons-col class="alignR" width="85px">'+b.modifier+"</ons-col></ons-row>"))}),h.push(c.average*c.weight/100),h.push(c.weight*(100-c.average)/100),k.push(getPIColor(a)),k.push(lightenColor(getPIColor(a),.4))):(d.append('<ons-row class="assignment">No items exist in this category</ons-row>'),g-=c.weight/100);b.append('<ons-row class="piLegRow"><ons-col width="20px"><div id="piLegCol" style="background-color:'+
getPIColor(a)+';"></div></ons-col><ons-col class="piLegColText">'+c.name+"</ons-col></ons-row>")});$.each(h,function(a,b){c.push(b/g)});drawPIChart(l,c,k);loadGradingPeriods({GBID:a.GBID,courseID:a.courseID,termName:a.termName});d.hide();d.fadeIn(400)})}
function drawPIChart(a,e,f){var d=a[0].getContext("2d"),b=3*Math.PI/2;$.each(e,function(e,h){d.fillStyle=f[e];d.beginPath();d.moveTo(a.width()/2,a.height()/2);d.arc(a.width()/2,a.height()/2,a.height()/2,b,b+h/100*Math.PI*2,!1);d.lineTo(a.width()/2,a.height()/2);d.fill();b+=h/100*Math.PI*2})}function getPIColor(a){return basePIColors[a%basePIColors.length]}
function loadGradingPeriods(a){var e=$.post(currentAcctURL+"gradebook002.w",{dwd:currentDWD,wfaacl:currentWFAACL,currentStudent:currentStudentID,currentGBId:a.GBID,currentCourseId:a.courseID}).done(function(){var f=$((new DOMParser).parseFromString(e.responseText,"text/html")).find(".myBox")[0];if(f){var d=$("#asmtHeaderRight");d.empty();var b=0;$.each(f.firstChild.children,function(e,f){var c=f.firstChild.firstChild.firstChild.firstChild.firstChild,g=c.firstChild.firstChild.firstChild.firstChild;
-1===g.children[2].innerHTML.toLowerCase().indexOf("no grades posted")&&(g=a.termName.substr(0,a.termName.lastIndexOf(" "))+" "+g.children[0].innerHTML,c=$(c).attr("onclick").split('"'),c=$('<option extType="'+c[1]+'" extNum="'+c[3]+'" termName="'+g+'" value="'+b+'">'+g+"</option>"),d.append(c),g===a.termName&&c.attr("selected",""),b++)})}})}
function selectGradingPeriod(a){var e=$("#asmtHeaderRight").children().eq($("#asmtHeaderRight")[0].value),f=e.attr("extType"),d=e.attr("extNum"),b=e.attr("termName");$("#assignmentList").fadeOut(FADE_TIME,function(){getAndParseCourse({GBID:a.GBID,courseID:a.courseID,extType:f,extNum:d,termName:b,grade:a.grade,name:a.name,teacher:a.teacher},loadGrades,!0)})};